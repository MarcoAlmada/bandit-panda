import pandas as pd

class EpsilonGreedy():

    def __init__(self, epsilon, counts=[], values=[]):

        self.epsilon = epsilon
        self.arms = pd.DataFrame({'Iteration':counts, 'Reward':values})
        self.arms.index.name = 'Arm'
        return

    def initialize(self, n_arms):

        self.arms = pd.DataFrame({'Iteration':[0], 'Reward':[0.0]}, range(n_arms))
        self.arms.index.name = 'Arm'
        return

    def select_arm(self):

        #print self.arms

        if pd.np.random.random() > self.epsilon:
            return self.arms['Reward'].idxmax()
        else:
            return pd.np.random.choice(self.arms.index)

    def update(self, chosen_arm, reward):

        n = self.update_count(chosen_arm)
        self.update_mean(chosen_arm, reward, n)
        return

    def update_count(self, chosen_arm):

        chosen_arm = int(chosen_arm)

        self.arms.ix[chosen_arm, 'Iteration'] += 1
        return self.arms.ix[chosen_arm, 'Iteration']

    def update_mean(self, chosen_arm, reward, n=None):

        chosen_arm = int(chosen_arm)
        #print chosen_arm

        if n == None:
            n = self.arms.ix[chosen_arm, 'Iteration']

        self.arms.ix[chosen_arm, 'Reward'] *= (n-1)/float(n)
        self.arms.ix[chosen_arm, 'Reward'] += reward/float(n)
        #print self.arms
        return
